{"version":3,"file":"dock-plugin.esm.js","sources":["../src/utils.ts","../src/click-strategy.ts","../src/drop-strategy.ts","../src/index.ts"],"sourcesContent":["import { Component } from \"rete\";\n\nexport async function createNode(component: Component, position: { x: number, y: number }) {\n    let node = await component.createNode({});\n\n    node.position = [position.x, position.y];\n\n    return node;\n}","import { Component, NodeEditor } from \"rete\";\nimport { createNode } from \"./utils\";\n\nexport class ClickStrategy {\n\n    editor: NodeEditor;\n    position: {x: number, y: number};\n\n    constructor(editor: NodeEditor) {\n        this.editor = editor;\n        this.position = {x: 0, y: 0}\n        \n        editor.on('click', () => {\n            this.position = editor.view.area.mouse;\n        });\n    }\n\n    addComponent(el: HTMLElement, component: Component) {\n        el.addEventListener('click', async () => {\n            const node = await createNode(component, this.position);\n\n            this.editor.addNode(node);\n        });\n    }\n}","import { Component, NodeEditor } from \"rete\";\nimport { createNode } from \"./utils\";\n\nexport class DropStrategy {\n\n    constructor(editor: NodeEditor) {\n        editor.view.container.addEventListener('dragover', e => e.preventDefault())\n        editor.view.container.addEventListener('drop', async e => {\n            if(!e.dataTransfer) return;\n\n            const name = e.dataTransfer.getData('componentName');\n            const component = editor.components.get(name)\n\n            if(!component) throw new Error(`Component ${name} not found`)\n\n            // force update the mouse position\n            editor.view.area.pointermove(e as any as PointerEvent);\n\n            const node = await createNode(component as Component, editor.view.area.mouse);\n\n            editor.addNode(node)\n        })\n    }\n\n    addComponent(el: HTMLElement, component: Component) {\n        el.draggable = true;\n\n        el.addEventListener('dragstart', e => {\n            if(!e.dataTransfer) return;\n\n            e.dataTransfer.setData('componentName', component.name);\n        });\n    }\n\n}","import { NodeEditor, Control, Component } from 'rete';\nimport { ClickStrategy } from './click-strategy';\nimport { DropStrategy } from './drop-strategy';\nimport { Plugin } from 'rete/types/core/plugin';\n\ntype PluginWithOptions = Plugin | [Plugin, any];\ntype Params = {\n    container: HTMLElement,\n    plugins: PluginWithOptions[],\n    itemClass: string,\n    identifyDockerNodes: boolean\n}\n\nfunction install(editor: NodeEditor, { container, plugins, itemClass = 'dock-item', identifyDockerNodes = false }: Params) {\n    if (!(container instanceof HTMLElement)) throw new Error('container is not HTML element');\n\n    const copy = new NodeEditor(editor.id, editor.view.container);\n    const clickStrategy = new ClickStrategy(editor);\n    const dropStrategy = new DropStrategy(editor);\n\n    plugins.forEach(plugin => {\n        if (Array.isArray(plugin))\n            copy.use(plugin[0], plugin[1])\n        else\n            copy.use(plugin)\n    });\n\n    editor.on('componentregister', async c => {\n        const component: Component = Object.create(c);\n        if (identifyDockerNodes) {\n            console.log('dock-component', component);\n            //@ts-ignore\n            if (component.dockerNode) {\n                const el = document.createElement('div');\n\n                el.classList.add(itemClass)\n\n                container.appendChild(el);\n\n                clickStrategy.addComponent(el, component);\n                dropStrategy.addComponent(el, component);\n\n                component.editor = copy;\n\n                copy.trigger('rendernode', {\n                    el,\n                    node: await component.createNode({}),\n                    component: component.data,\n                    bindSocket: () => { },\n                    bindControl: (element: HTMLElement, control: Control) => {\n                        copy.trigger('rendercontrol', { el: element, control });\n                    }\n                });\n            }\n        } else {\n            const el = document.createElement('div');\n\n            el.classList.add(itemClass)\n\n            container.appendChild(el);\n\n            clickStrategy.addComponent(el, component);\n            dropStrategy.addComponent(el, component);\n\n            component.editor = copy;\n\n            copy.trigger('rendernode', {\n                el,\n                node: await component.createNode({}),\n                component: component.data,\n                bindSocket: () => { },\n                bindControl: (element: HTMLElement, control: Control) => {\n                    copy.trigger('rendercontrol', { el: element, control });\n                }\n            });\n        }\n    });\n}\n\nexport default {\n    name: 'dock',\n    install\n}\n"],"names":["createNode","component","position","node","x","y","ClickStrategy","editor","on","view","area","mouse","el","addEventListener","addNode","DropStrategy","container","e","preventDefault","dataTransfer","name","getData","components","get","Error","pointermove","draggable","setData","install","plugins","itemClass","identifyDockerNodes","HTMLElement","copy","NodeEditor","id","clickStrategy","dropStrategy","forEach","plugin","Array","isArray","use","c","Object","create","console","log","dockerNode","document","createElement","classList","add","appendChild","addComponent","data","element","control","trigger","bindSocket","bindControl"],"mappings":"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"}