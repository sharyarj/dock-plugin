{"version":3,"file":"dock-plugin.min.js","sources":["../src/utils.ts","../src/click-strategy.ts","../src/drop-strategy.ts","../src/index.ts"],"sourcesContent":["import { Component } from \"rete\";\n\nexport async function createNode(component: Component, position: { x: number, y: number }) {\n    let node = await component.createNode({});\n\n    node.position = [position.x, position.y];\n\n    return node;\n}","import { Component, NodeEditor } from \"rete\";\nimport { createNode } from \"./utils\";\n\nexport class ClickStrategy {\n\n    editor: NodeEditor;\n    position: {x: number, y: number};\n\n    constructor(editor: NodeEditor) {\n        this.editor = editor;\n        this.position = {x: 0, y: 0}\n        \n        editor.on('click', () => {\n            this.position = editor.view.area.mouse;\n        });\n    }\n\n    addComponent(el: HTMLElement, component: Component) {\n        el.addEventListener('click', async () => {\n            const node = await createNode(component, this.position);\n\n            this.editor.addNode(node);\n        });\n    }\n}","import { Component, NodeEditor } from \"rete\";\nimport { createNode } from \"./utils\";\n\nexport class DropStrategy {\n\n    constructor(editor: NodeEditor) {\n        editor.view.container.addEventListener('dragover', e => e.preventDefault())\n        editor.view.container.addEventListener('drop', async e => {\n            if(!e.dataTransfer) return;\n\n            const name = e.dataTransfer.getData('componentName');\n            const component = editor.components.get(name)\n\n            if(!component) throw new Error(`Component ${name} not found`)\n\n            // force update the mouse position\n            editor.view.area.pointermove(e as any as PointerEvent);\n\n            const node = await createNode(component as Component, editor.view.area.mouse);\n\n            editor.addNode(node)\n        })\n    }\n\n    addComponent(el: HTMLElement, component: Component) {\n        el.draggable = true;\n\n        el.addEventListener('dragstart', e => {\n            if(!e.dataTransfer) return;\n\n            e.dataTransfer.setData('componentName', component.name);\n        });\n    }\n\n}","import { NodeEditor, Control, Component } from 'rete';\nimport { ClickStrategy } from './click-strategy';\nimport { DropStrategy } from './drop-strategy';\nimport { Plugin } from 'rete/types/core/plugin';\n\ntype PluginWithOptions = Plugin | [Plugin, any];\ntype Params = {\n    container: HTMLElement,\n    plugins: PluginWithOptions[],\n    itemClass: string,\n    identifyDockerNodes: boolean\n}\n\nfunction install(editor: NodeEditor, { container, plugins, itemClass = 'dock-item', identifyDockerNodes = false }: Params) {\n    if (!(container instanceof HTMLElement)) throw new Error('container is not HTML element');\n\n    const copy = new NodeEditor(editor.id, editor.view.container);\n    const clickStrategy = new ClickStrategy(editor);\n    const dropStrategy = new DropStrategy(editor);\n\n    plugins.forEach(plugin => {\n        if (Array.isArray(plugin))\n            copy.use(plugin[0], plugin[1])\n        else\n            copy.use(plugin)\n    });\n\n    editor.on('componentregister', async c => {\n        const component: Component = Object.create(c);\n        if (identifyDockerNodes) {\n            //@ts-ignore\n            if (component.dockerNode) {\n                const el = document.createElement('div');\n\n                el.classList.add(itemClass)\n\n                container.appendChild(el);\n\n                clickStrategy.addComponent(el, component);\n                dropStrategy.addComponent(el, component);\n\n                component.editor = copy;\n\n                copy.trigger('rendernode', {\n                    el,\n                    node: await component.createNode({}),\n                    component: component.data,\n                    bindSocket: () => { },\n                    bindControl: (element: HTMLElement, control: Control) => {\n                        copy.trigger('rendercontrol', { el: element, control });\n                    }\n                });\n            }\n        } else {\n            const el = document.createElement('div');\n\n            el.classList.add(itemClass)\n\n            container.appendChild(el);\n\n            clickStrategy.addComponent(el, component);\n            dropStrategy.addComponent(el, component);\n\n            component.editor = copy;\n\n            copy.trigger('rendernode', {\n                el,\n                node: await component.createNode({}),\n                component: component.data,\n                bindSocket: () => { },\n                bindControl: (element: HTMLElement, control: Control) => {\n                    copy.trigger('rendercontrol', { el: element, control });\n                }\n            });\n        }\n    });\n}\n\nexport default {\n    name: 'dock',\n    install\n}\n"],"names":["createNode","component","position","node","x","y","ClickStrategy","editor","on","_this","view","area","mouse","el","addEventListener","_this2","addNode","DropStrategy","container","e","preventDefault","dataTransfer","name","getData","components","get","Error","pointermove","draggable","setData","install","plugins","itemClass","identifyDockerNodes","HTMLElement","copy","NodeEditor","id","clickStrategy","dropStrategy","forEach","plugin","Array","isArray","use","c","Object","create","dockerNode","document","createElement","classList","add","appendChild","addComponent","data","element","control","trigger","bindSocket","bindControl"],"mappings":";;;;;olOAEsBA,mFAAf,WAA0BC,EAAsBC,wGAClCD,EAAUD,WAAW,kBAAlCG,UAECD,SAAW,CAACA,EAASE,EAAGF,EAASG,qBAE/BF,uECJEG,EAAb,sBAKgBC,+EACHA,OAASA,OACTL,SAAW,CAACE,EAAG,EAAGC,EAAG,GAE1BE,EAAOC,GAAG,QAAS,WACfC,EAAKP,SAAWK,EAAOG,KAAKC,KAAKC,uDAI5BC,EAAiBZ,cAC1BY,EAAGC,iBAAiB,kCAAS,kHACNd,EAAWC,EAAWc,EAAKb,iBAAxCC,SAENY,EAAKR,OAAOS,QAAQb,mDAlBhC,GCAac,EAAb,sBAEgBV,aACRA,EAAOG,KAAKQ,UAAUJ,iBAAiB,WAAY,SAAAK,UAAKA,EAAEC,mBAC1Db,EAAOG,KAAKQ,UAAUJ,iBAAiB,kDAAQ,WAAMK,+FAC7CA,EAAEE,iEAEAC,EAAOH,EAAEE,aAAaE,QAAQ,iBAC9BtB,EAAYM,EAAOiB,WAAWC,IAAIH,yBAEnB,IAAII,0BAAmBJ,+BAG5Cf,EAAOG,KAAKC,KAAKgB,YAAYR,YAEVnB,EAAWC,EAAwBM,EAAOG,KAAKC,KAAKC,cAAjET,SAENI,EAAOS,QAAQb,mJAIVU,EAAiBZ,GAC1BY,EAAGe,WAAY,EAEff,EAAGC,iBAAiB,YAAa,SAAAK,GACzBA,EAAEE,cAENF,EAAEE,aAAaQ,QAAQ,gBAAiB5B,EAAUqB,cA3B9D,SC2Ee,CACXA,KAAM,OACNQ,QAnEJ,SAAiBvB,SAAsBW,IAAAA,UAAWa,IAAAA,YAASC,UAAAA,aAAY,kBAAaC,oBAAAA,qBAC1Ef,aAAqBgB,aAAc,MAAM,IAAIR,MAAM,qCAEnDS,EAAO,IAAIC,aAAW7B,EAAO8B,GAAI9B,EAAOG,KAAKQ,WAC7CoB,EAAgB,IAAIhC,EAAcC,GAClCgC,EAAe,IAAItB,EAAaV,GAEtCwB,EAAQS,QAAQ,SAAAC,GACRC,MAAMC,QAAQF,GACdN,EAAKS,IAAIH,EAAO,GAAIA,EAAO,IAE3BN,EAAKS,IAAIH,KAGjBlC,EAAOC,GAAG,+DAAqB,WAAMqC,+FAC3B5C,EAAuB6C,OAAOC,OAAOF,IACvCZ,sBAEIhC,EAAU+C,kBACJnC,EAAKoC,SAASC,cAAc,QAE/BC,UAAUC,IAAIpB,GAEjBd,EAAUmC,YAAYxC,GAEtByB,EAAcgB,aAAazC,EAAIZ,GAC/BsC,EAAae,aAAazC,EAAIZ,GAE9BA,EAAUM,OAAS4B,OAEnBA,OACItB,YACYZ,EAAUD,WAAW,6CACtBC,EAAUsD,UACT,kBACC,SAACC,EAAsBC,GAChCtB,EAAKuB,QAAQ,gBAAiB,CAAE7C,GAAI2C,EAASC,QAAAA,WALjD5C,QACAV,UACAF,eACA0D,gBACAC,uBALCF,kBAAQ,0DAWX7C,EAAKoC,SAASC,cAAc,QAE/BC,UAAUC,IAAIpB,GAEjBd,EAAUmC,YAAYxC,GAEtByB,EAAcgB,aAAazC,EAAIZ,GAC/BsC,EAAae,aAAazC,EAAIZ,GAE9BA,EAAUM,OAAS4B,OAEnBA,OACItB,YACYZ,EAAUD,WAAW,8BACtBC,EAAUsD,WACT,mBACC,SAACC,EAAsBC,GAChCtB,EAAKuB,QAAQ,gBAAiB,CAAE7C,GAAI2C,EAASC,QAAAA,YALjD5C,QACAV,UACAF,gBACA0D,iBACAC,wBALCF,kBAAQ"}